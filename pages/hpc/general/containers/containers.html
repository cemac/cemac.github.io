

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Containers WorkShop 2021 &mdash; cemac.github.io 1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/twemoji.css" />

  
      <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../_static/documentation_options.js?v=29a6c3e3"></script>
      <script src="../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="https://unpkg.com/twemoji@latest/dist/twemoji.min.js"></script>
      <script src="../../../../_static/twemoji.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Profiling and Optimisation" href="../profiling/index.html" />
    <link rel="prev" title="Containers" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            cemac.github.io
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Categories:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../computing/index.html">General computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../python/index.html">Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../version_control/index.html">Version Control</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">HPC Systems</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">General</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../cloud_computing/index.html">Cloud Computing</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Containers</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">Containers WorkShop 2021</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../profiling/index.html">Profiling and Optimisation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../jasmin/index.html">JASMIN</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../puma/index.html">PUMA2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../bede/index.html">Bede</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../ai_ml/index.html">AI and Machine Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modelling/index.html">Numerical Modelling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data_vis/index.html">Data Visualisation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">cemac.github.io</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">HPC Systems</a></li>
          <li class="breadcrumb-item"><a href="../index.html">General</a></li>
          <li class="breadcrumb-item"><a href="index.html">Containers</a></li>
      <li class="breadcrumb-item active">Containers WorkShop 2021</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../_sources/pages/hpc/general/containers/containers.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="containers-workshop-2021">
<h1>Containers WorkShop 2021<a class="headerlink" href="#containers-workshop-2021" title="Link to this heading"></a></h1>
<p>Various members of the CEMAC team attended the ARCHER 2 containers workshop in July 2021.</p>
<p>Here’s a quick start guide from that tutorial</p>
<section id="set-up">
<h2>Set Up<a class="headerlink" href="#set-up" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Installation of docker and sigularity are out lined <a class="reference external" href="https://epcced.github.io/2021-07-28_Containers_Online/setup.html">here</a></p></li>
</ul>
</section>
<section id="day-1-containers">
<h2>Day 1 - Containers<a class="headerlink" href="#day-1-containers" title="Link to this heading"></a></h2>
<p>The course outline is found <a class="reference external" href="https://epcced.github.io/2021-07-28_Containers_Online/">here</a></p>
<p><strong>Why use containers?</strong> - main point is reproducibility with software i.e.</p>
<ul class="simple">
<li><p>time goes by and dependencies break</p></li>
<li><p>missing bits of documentation</p></li>
<li><p>systems no longer exist with software stack</p></li>
<li><p>cloud system no longer have access to</p></li>
</ul>
<section id="docker-command-line">
<h3><a class="reference external" href="https://epcced.github.io/2021-07-28_Containers_Online/02-meet-docker/index.html">Docker command line</a><a class="headerlink" href="#docker-command-line" title="Link to this heading"></a></h3>
<p>To not have to run as sudo look <a class="reference external" href="https://docs.docker.com/engine/install/linux-postinstall/">here</a></p>
<p>Once docker is installed</p>
<p>Start the docker engine</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>dockerd
</pre></div>
</div>
<p>check commands work</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>--version
docker<span class="w"> </span>container<span class="w"> </span>ls
docker<span class="w"> </span>container<span class="w"> </span>--help
docker<span class="w"> </span>container<span class="w"> </span>ls<span class="w"> </span>--help<span class="w">  </span>
docker<span class="w"> </span>build<span class="w"> </span>--help
</pre></div>
</div>
</section>
<section id="hello-world-example">
<h3>hello world example<a class="headerlink" href="#hello-world-example" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>container<span class="w"> </span>ls
docker<span class="w"> </span>pull<span class="w"> </span>hello-world
docker<span class="w"> </span>container<span class="w"> </span>ls
docker<span class="w"> </span>run<span class="w"> </span>hello-world
</pre></div>
</div>
</section>
</section>
<section id="running-a-linux-container">
<h2><a class="reference external" href="https://epcced.github.io/2021-07-28_Containers_Online/03-running-containers/index.html">Running a linux container</a><a class="headerlink" href="#running-a-linux-container" title="Link to this heading"></a></h2>
<p>You don’t have to bother with <code class="docutils literal notranslate"><span class="pre">pull</span></code> command <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span></code> will do this if the container isn’t found locally e.g.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>run<span class="w"> </span>alpine
</pre></div>
</div>
<p>we can get the container to print its os info or print hello world</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>run<span class="w"> </span>alpine<span class="w"> </span>cat<span class="w"> </span>/etc/os-release
docker<span class="w"> </span>run<span class="w"> </span>alpine<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;Hello World&#39;</span>
</pre></div>
</div>
<p><strong>note the speed of this compared to a VM</strong></p>
<p>we can also run this <strong>interactively</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>alpine<span class="w"> </span>sh
</pre></div>
</div>
<p>you can run various linux commands now and and run <code class="docutils literal notranslate"><span class="pre">exit</span></code> to stop</p>
</section>
<section id="finding-containers-on-docker-hub">
<h2><a class="reference external" href="https://epcced.github.io/2021-07-28_Containers_Online/04-docker-hub/index.html">Finding Containers on docker hub</a><a class="headerlink" href="#finding-containers-on-docker-hub" title="Link to this heading"></a></h2>
<p>Owned by docker team:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># docker pull CONTAINER:TAG</span>
docker<span class="w"> </span>pull<span class="w"> </span>python:3.8
</pre></div>
</div>
<p>Docker hub community space (check the containers are legit before downloading)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># docker pull OWNER/CONTAINER:TAG</span>
docker<span class="w"> </span>pull<span class="w"> </span>rocker/tidyverse:3.6.1
</pre></div>
</div>
<section id="tidying-up">
<h3>Tidying up<a class="headerlink" href="#tidying-up" title="Link to this heading"></a></h3>
<section id="check-whats-running">
<h4>Check whats Running<a class="headerlink" href="#check-whats-running" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># running</span>
docker<span class="w"> </span>ps
<span class="c1"># run recently and get list of recent exited containers</span>
docker<span class="w"> </span>container<span class="w"> </span>ls<span class="w"> </span>--all
</pre></div>
</div>
</section>
<section id="remove-exited-container">
<h4>remove exited container<a class="headerlink" href="#remove-exited-container" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># single container</span>
docker<span class="w"> </span>container<span class="w"> </span>rm<span class="w"> </span>&lt;container<span class="w"> </span>ID&gt;
<span class="c1"># tidy all</span>
docker<span class="w"> </span>container<span class="w"> </span>prune
</pre></div>
</div>
<p>Now we can remove images (if you’ve not done the steps above you may get an error)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># get image id</span>
docker<span class="w"> </span>image<span class="w"> </span>ls
docker<span class="w"> </span>image<span class="w"> </span>rm<span class="w"> </span>&lt;image<span class="w"> </span>id&gt;
</pre></div>
</div>
</section>
</section>
</section>
<section id="creating-your-own-container">
<h2><a class="reference external" href="https://epcced.github.io/2021-07-28_Containers_Online/05-creating-container-images/index.html">Creating your own container</a><a class="headerlink" href="#creating-your-own-container" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Create <a class="reference internal" href="#/Docker_example/Dockerfile"><span class="xref myst">Dockerfile</span></a></p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>&lt;username&gt;/docker_example<span class="w"> </span>Docker_example/
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">docker</span></code> will build any <code class="docutils literal notranslate"><span class="pre">Dockerfile</span></code> it finds in the directory specified</p>
<p>now you can run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>image<span class="w"> </span>ls
docker<span class="w"> </span>run<span class="w"> </span>&lt;username&gt;/docker_example<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Hello World&quot;</span>
</pre></div>
</div>
<section id="pushing-to-dockerhub">
<h3>Pushing to dockerhub<a class="headerlink" href="#pushing-to-dockerhub" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>login
docker<span class="w"> </span>tag<span class="w"> </span>&lt;username&gt;docker_example<span class="w"> </span>&lt;username&gt;/docker_test_example:v1
docker<span class="w"> </span>push<span class="w"> </span>&lt;username&gt;/docker_test_example:v1
</pre></div>
</div>
</section>
<section id="starting-points">
<h3>Starting points<a class="headerlink" href="#starting-points" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>keep simple software stack</p></li>
<li><p>use linux flavours like ubuntu or centos</p></li>
</ul>
</section>
<section id="mounting-files">
<h3>mounting files<a class="headerlink" href="#mounting-files" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>run<span class="w"> </span>-v<span class="w"> </span>&lt;pathtodirhost&gt;:/temp<span class="w"> </span>&lt;username&gt;/docker_example<span class="w"> </span>python3<span class="w"> </span>&lt;pathtodircontainer&gt;/sum.py
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">sum.py</span></code> takes input vars and sums them so you can add numbers to the end of the above script to alter the output</p>
</section>
<section id="creating-a-more-complex-container">
<h3>creating a more complex container<a class="headerlink" href="#creating-a-more-complex-container" title="Link to this heading"></a></h3>
<p>This <a class="reference internal" href="#"><span class="xref myst">Dockerfile</span></a> will build the container with the sum function as the default fuction with some default input options</p>
<p>This <a class="reference internal" href="#"><span class="xref myst">Dockerfile</span></a> will build the container with the sum function added to the path but you can also use other functions and commands easily</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>&lt;username&gt;/complex_docker_example:v1<span class="w"> </span>&lt;pathtodirwithdockerfile&gt;
</pre></div>
</div>
<p>This example <code class="docutils literal notranslate"><span class="pre">COPY</span></code> local files but you can also get files via wget or git</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>RUN<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/&lt;username&gt;/&lt;repo&gt;
RUN<span class="w"> </span>wget<span class="w"> </span>&lt;url&gt;
</pre></div>
</div>
</section>
</section>
<section id="archiving-and-reproducibility">
<h2>Archiving and reproducibility<a class="headerlink" href="#archiving-and-reproducibility" title="Link to this heading"></a></h2>
<p>This is mostly explained in the course documentation <a class="reference external" href="https://epcced.github.io/2021-07-28_Containers_Online/08-reproducibility/index.html">here</a></p>
<hr>
</section>
<section id="singularity">
<h2><a class="reference external" href="https://epcced.github.io/2021-07-29_Singularity_Online/">Singularity</a><a class="headerlink" href="#singularity" title="Link to this heading"></a></h2>
<p>Singularity is availble on archer2 and arc4 you might need to <code class="docutils literal notranslate"><span class="pre">module</span> <span class="pre">load</span></code> it in</p>
<p>on archer2</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>singularity<span class="w"> </span>--version
</pre></div>
</div>
<p>shows its working.</p>
<p>No need to start daemone like with docker. I a test dir</p>
<section id="pull-run-and-inspect">
<h3>Pull, run and inspect:<a class="headerlink" href="#pull-run-and-inspect" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>singularity<span class="w"> </span>pull<span class="w"> </span>hello-world.sif<span class="w"> </span>shub://vsoch/hello-world
singularity<span class="w"> </span>run<span class="w"> </span>hello-world.sif
singularity<span class="w"> </span>inspect<span class="w"> </span>-r<span class="w"> </span>hello-world.sif
</pre></div>
</div>
</section>
<section id="tidying-up-caches">
<h3>tidying up caches<a class="headerlink" href="#tidying-up-caches" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rm<span class="w"> </span>hello-world.sif
singularity<span class="w"> </span>pull<span class="w"> </span>hello-world.sif<span class="w"> </span>shub://vsoch/hello-world
singularity<span class="w"> </span>cache<span class="w"> </span>list
singularity<span class="w"> </span>cache<span class="w"> </span>list<span class="w"> </span>-v
singularity<span class="w"> </span>cache<span class="w"> </span>clean
</pre></div>
</div>
</section>
</section>
<section id="run-vs-exc">
<h2>Run vs exc<a class="headerlink" href="#run-vs-exc" title="Link to this heading"></a></h2>
<p>exec allows us to run the non default command</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>singularity<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>hello-world.sif<span class="w"> </span>/bin/echo<span class="w"> </span>Hello<span class="w"> </span>World!
singularity<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>hello-world.sif<span class="w"> </span>/bin/date
</pre></div>
</div>
<section id="interactive-shell-and-files">
<h3>interactive shell and files<a class="headerlink" href="#interactive-shell-and-files" title="Link to this heading"></a></h3>
<p>enter the container with the shell command</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>singularity<span class="w"> </span>shell<span class="w"> </span>hello-world.sif
</pre></div>
</div>
<p>running <code class="docutils literal notranslate"><span class="pre">whoami</span></code> will display your username rather than root and will show the current directory, often bind mounting to home dir - works for  your work directory as well</p>
<p>you won’t be able to access the other files on the system e.g. other users directory</p>
<p>you can create files on the host system with in the container</p>
</section>
<section id="adding-shared-directories">
<h3>adding shared directories<a class="headerlink" href="#adding-shared-directories" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>singularity<span class="w"> </span>shell<span class="w"> </span>-B<span class="w"> </span>/work/z19/shared<span class="w"> </span>hello-world.sif
</pre></div>
</div>
</section>
<section id="id1">
<h3><a class="headerlink" href="#id1" title="Link to this heading"></a></h3>
</section>
<section id="opening-docker-images-with-singularity">
<h3>opening docker images with singularity<a class="headerlink" href="#opening-docker-images-with-singularity" title="Link to this heading"></a></h3>
<p>you can pull docker images and convert to sif files</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>singularity<span class="w"> </span>pull<span class="w"> </span>python-3.9.6.sif<span class="w"> </span>docker://python:3.9.6-slim-buster
</pre></div>
</div>
</section>
<section id="making-sif-files">
<h3>Making SIF files<a class="headerlink" href="#making-sif-files" title="Link to this heading"></a></h3>
<p>You need route access to create SIF files</p>
<p>There are three different options for accessing a suitable environment to undertake the material in this part of the course:</p>
<ol class="arabic simple">
<li><p>Run Singularity from within a Docker container - this will enable you to have the required privileges to build images</p></li>
<li><p>Install Singularity locally on a system where you have administrative access</p></li>
<li><p>Use Singularity on a system where it is already pre-installed and you have administrative (root) access</p></li>
</ol>
<p>sigularity Installation on a local machine requires lots of dependencies so this tutorial uses a docker singularity contaier and aliases it as singularity</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">alias</span><span class="w"> </span><span class="nv">singularity</span><span class="o">=</span><span class="s1">&#39;docker run --privileged -v ${PWD}:/home/singularity quay.io/singularity/singularity:v3.5.3-slim&#39;</span>
</pre></div>
</div>
<p><em>NB might need sudo in the alias on linux</em></p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Containers" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../profiling/index.html" class="btn btn-neutral float-right" title="Profiling and Optimisation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Centre for Environmental Modelling and Computation.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>